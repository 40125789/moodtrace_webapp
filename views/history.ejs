<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood History - Mood Trace</title>

   <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="stylesheet" href="/styles/style.css" type="text/css">

<!-- FontAwesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="correct-fontawesome-integrity-value" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.css">

<!-- Include jQuery, Popper.js, and Bootstrap JS -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<!-- Include the latest Bootstrap Multiselect CSS and JS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.js"></script>
    <!--<script type="module" src="header/navbar.js" defer></script>-->
    <!-- <my-navbar></my-navbar> -->

    <style>
      /* CSS for hover effect */
    .table-bordered tbody tr:hover td {
    background-color: #3bc0e8 !important; /* Use !important to ensure it overrides other styles */
    cursor: pointer; /* Change cursor to pointer on hover to indicate it's clickable */
}


        /* CSS to make each column the same width */
        table.table-bordered thead th,
        table.table-bordered tbody td {
            width: 10%; /* Adjust the width as needed */

            /* Additional styles for specific columns */
            text-align: center; /* Center align content */
            white-space: nowrap; /* Avoid wrapping content */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Show ellipsis for overflow */
        }

        /* Make Date and Time and Contextual Trigger wider */
        table.table-bordered thead th:first-child,
        table.table-bordered tbody td:first-child,
        table.table-bordered thead th:last-child,
        table.table-bordered tbody td:last-child {
            width: 15%; /* Adjust the width as needed */
        }
    </style>

</head>


<body>
    <nav class="navbar navbar-expand-lg bg-info navbar-dark">
        <div class="container">
            <a href="/" class="navbar-brand" style="font-weight: bold">Mood Trace</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navmenu">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <div class="collapse navbar-collapse" id="navmenu">
                <ul class="navbar-nav">
                    <% if (isloggedin) { %>
                        <li class="nav-item">
                            <a href="/dashboard" class="nav-link"><i class="fas fa-home"></i> Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="/record" class="nav-link"><i class="fas fa-book"></i> Record</a>
                        </li>
                        <li class="nav-item">
                            <a href="/history" class="nav-link"><i class="fas fa-history"></i> History</a>
                        </li>
                        <li class="nav-item">
                            <a href="/statistics" class="nav-link"><i class="fas fa-chart-line"></i> Trends</a>
                        </li>
                    <% } %>
                </ul>
    
                <!-- Conditionally render login/register or logout link based on user authentication -->
                <ul class="navbar-nav ml-auto">
                    <% if (isloggedin) { %>
                        <!-- User is logged in -->
                        <li class="nav-item">
                            <a href="/logout" class="nav-link"><i class="fa-solid fa-right-to-bracket"></i> Log out</a>
                        </li>
                    <% } else { %>
                        <!-- User is not logged in -->
                        <li class="nav-item">
                            <a href="/register" class="nav-link"><i class="fa-solid fa-user"></i> Register</a>
                        </li>
                        <li class="nav-item">
                            <a href="/login" class="nav-link"><i class="fa-solid fa-right-to-bracket"></i> Log in</a>
                        </li>
                    <% } %>
                </ul>
            </div>
        </div>
    </nav>
    
    <section class="bg-light text-dark p-5 text-center text-sm-start">
        <div class="container">
            <div class="d-sm-flex">
                <div>
                    <h1>Mood Log History</h1>
                    <p class="lead my-4" style="font-weight: 600">
                        View your previously recorded snapshots here!
                    </p>
                    <p class="lead my-4" style="font-weight: 400">You can also edit a contextual trigger by clicking on a snapshot below:</p>
    
                    <!-- Display the recorded moods in a horizontal table -->
                    <div class="row" id="moodGrid">
                        <div class="col-lg-12">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date and Time</th>
                                        <th>Snapshot ID</th>
                                        <th>ðŸ˜ŠEnjoyment</th>
                                        <th>ðŸ˜¢Sadness</th>
                                        <th>ðŸ˜ Anger</th>
                                        <th>ðŸ˜’Contempt</th>
                                        <th>ðŸ¤¢Disgust</th>
                                        <th>ðŸ˜¨Fear</th>
                                        <th>ðŸ˜²Surprise</th>
                                        <th>Contextual Trigger(s)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for (let mood of moods) { %>
                                        <tr data-mood-id="<%= mood.snapshot_id %>" data-contextual-trigger="<%= mood.contextual_triggers %>" onclick="selectRow(this)" onmouseover="highlightRow(this)" onmouseout="unhighlightRow(this)">
                                            <td style="font-weight: bold;"><%= new Date(mood.date_time).toLocaleString() %></td>
                                            <td><%= mood.snapshot_id %></td>
                                            <td><%= mood.enjoyment_level %></td>
                                            <td><%= mood.sadness_level %></td>
                                            <td><%= mood.anger_level %></td>
                                            <td><%= mood.contempt_level %></td>
                                            <td><%= mood.disgust_level %></td>
                                            <td><%= mood.fear_level %></td>
                                            <td><%= mood.surprise_level %></td>
                                            <td><%= mood.contextual_triggers ? mood.contextual_triggers : 'None' %></td>
                                        </tr>
                                    <% } %>
                                </tbody>
                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Back Button -->
        <button class="btn btn-secondary mb-3" onclick="goBack()">Back</button>
    </section>

    
    
    <script>
        function goBack() {
            // Navigate back to the previous page
            window.history.back();
        }
    
        function selectRow(row) {
            // Get the contextual trigger value from the selected row
            const contextualTrigger = row.getAttribute('data-contextual-trigger');
            const moodId = row.getAttribute('data-mood-id'); // Assuming you have a 'data-mood-id' attribute on the row
    
            // Redirect to the edit and delete page with both trigger and moodId
            window.location.href = `/views/editdeletetrigger?trigger=${encodeURIComponent(contextualTrigger)}&moodId=${encodeURIComponent(moodId)}`;
        }
    
        function highlightRow(row) {
            row.style.backgroundColor = "#0dadde"; // Adjust the color to match the hover effect
        }
    
        function unhighlightRow(row) {
            row.style.backgroundColor = ""; // Reset the background color
        }
    </script>
    



    
</body>

</html>
